import{getKlanten,getMandjes,getLiveKlant,getBerichten}from"./storageItems.js";import{updateNavbar}from"./navbar.js";import{showMessage,showToast}from"./notify.js";import{Bericht}from"./classes.js";import{validateEmail}from"./validate.js";const Swal=window["Swal"];function deleteArtikel(e){var n=e.target.dataset["klant"],e=parseInt(e.target.dataset.index),d=getMandjes(),a=d[n],l=a.artikelen.splice(e,1);if(l[0]){d[n]=a,localStorage.setItem("mandjes",JSON.stringify(d)),document.querySelector(`tr[data-row="${e}"`).remove();let t=0;var i=document.querySelectorAll("#results-table-body tr"),r=document.querySelectorAll("#results-table-body button");for(let e=0;e<a.artikelen.length;e++)i[e].setAttribute("data-row",e),r[e].setAttribute("data-index",e),t+=parseFloat(a.artikelen[e].prijs);document.getElementById("totaal")&&document.getElementById("totaal").remove();var n=document.getElementById("results-table-body"),d=document.createElement("tr"),e=(d.id="totaal",document.createElement("td")),c=document.createElement("td"),o=document.createElement("td"),m=document.createElement("td");e.innerText="",c.innerText="Totaalprijs",o.innerText="€"+t.toFixed(2).toString(),m.innerText="",d.appendChild(e),d.appendChild(c),d.appendChild(o),d.appendChild(m),n.appendChild(d),updateNavbar(),showToast("Verwijderd",l[0].naam,"success"),0===a.artikelen.length&&(console.log("Geen artikelen meer"),e=document.createElement("tr"),c=document.createElement("td"),o=document.createElement("td"),m=document.createElement("td"),c.innerText="---",o.innerText="Geen artikelen in mandje",m.innerText="---",e.appendChild(c),e.appendChild(o),e.appendChild(m),document.getElementById("results-table-body").appendChild(e))}else console.log("Er ging iets mis, maar weet nog niet wat")}function createRow(e,t,n){var d=document.getElementById("results-table-body"),a=document.createElement("tr"),l=(a.setAttribute("data-row",t),document.createElement("td")),i=document.createElement("td"),r=document.createElement("td"),c=document.createElement("td"),o=document.createElement("button");c.classList.add("uk-text-right"),o.classList.add("uk-button"),o.classList.add("uk-button-danger"),o.classList.add("uk-button-small"),o.type="button",o.setAttribute("data-index",t),o.setAttribute("data-klant",n),o.innerText="X",o.addEventListener("click",deleteArtikel),l.innerText=e.id,i.innerText=e.naam,r.innerText="€"+e.prijs,c.appendChild(o),a.appendChild(l),a.appendChild(i),a.appendChild(r),a.appendChild(c),d.appendChild(a)}function populateResults(){var e=getMandjes(),n=document.getElementById("results-table-body"),d=document.querySelectorAll("#results-table-body tr"),a=(d.length&&d.forEach(e=>{e.remove()}),getLiveKlant().naam);if(e[a]&&e[a].artikelen.length){var l=e[a]["artikelen"];let t=0;for(let e=0;e<l.length;e++)createRow(l[e],e,a),t+=parseFloat(l[e].prijs);var d=document.createElement("tr"),e=(d.id="totaal",document.createElement("td")),i=document.createElement("td"),r=document.createElement("td"),c=document.createElement("td");e.innerText="",i.innerText="Totaalprijs",r.innerText="€"+t.toFixed(2).toString(),c.innerText="",d.appendChild(e),d.appendChild(i),d.appendChild(r),d.appendChild(c),n.appendChild(d)}else{e=document.createElement("tr"),i=document.createElement("td"),r=document.createElement("td"),c=document.createElement("td");i.innerText="---",r.innerText="Geen artikelen in mandje",c.innerText="---",e.appendChild(i),e.appendChild(r),e.appendChild(c),n.appendChild(e)}}function deleteBericht(e){e.preventDefault();var t=getBerichten();let n=document.querySelectorAll("#berichten-lijst .bericht");var d,a=e.target.dataset.index,e=t.splice(a,1);for(let e=0;e<n.length;e++)n[e].dataset.index===a&&n[e].remove();if(e[0]){n=document.querySelectorAll("#berichten-lijst .bericht");var l=document.querySelectorAll("#berichten-lijst .delete-link");for(let e=n.length-1;0<=e;e--)n[e].setAttribute("data-index",e),l[e].setAttribute("data-index",e)}localStorage.setItem("berichten",JSON.stringify(t)),0===t.length&&(e=document.getElementById("berichten-lijst"),t=document.createElement("div"),(d=document.createElement("h4")).innerText="Er zijn nog geen berichten van klanten",t.appendChild(d),e.appendChild(t)),showToast("Verwijderd","Het bericht is verwijderd","success")}function createBericht(e,t){var n=getLiveKlant(),d=document.getElementById("berichten-lijst"),a=document.createElement("div"),l=(a.setAttribute("data-index",t),a.style.backgroundColor="#FFFEE0",a.style.padding="15px",a.style.marginBottom="15px",a.style.borderRadius="8px",a.style.border="1px solid gray",a.classList.add("bericht"),a.classList.add("uk-box-shadow-medium"),document.createElement("div")),i=(l.classList.add("uk-grid"),document.createElement("div")),r=(i.classList.add("uk-width-1-2"),document.createElement("p")),r=(r.innerText=e.nickname,i.appendChild(r),l.appendChild(i),document.createElement("div")),i=(r.classList.add("uk-width-1-2"),document.createElement("p")),i=(i.innerText=e.date+" "+e.time,r.appendChild(i),l.appendChild(r),a.appendChild(l),document.createElement("div")),r=document.createElement("h4"),l=(r.innerText=e.titel,i.appendChild(r),a.appendChild(i),document.createElement("div")),r=document.createElement("p");r.innerText=e.text,l.appendChild(r),a.appendChild(l),n.admin&&(i=document.createElement("div"),(e=document.createElement("a")).classList.add("delete-link"),e.href="",e.innerText="Verwijder bericht",e.setAttribute("data-index",t),i.appendChild(e),e.addEventListener("click",deleteBericht),a.appendChild(i)),d.appendChild(a)}function plaatsBericht(e){e.preventDefault();var t,n,d,e=document.getElementById("input-nick").value,a=document.getElementById("input-email").value,l=document.getElementById("input-titel").value,i=document.getElementById("input-bericht").value;e&&a&&l&&i?validateEmail(a)?(a=getKlanten(),t=getBerichten(),a=a[getLiveKlant().naam],d=(n=new Date).toLocaleDateString(),n=n.toLocaleTimeString(),d=new Bericht(d,n,a,e,l,i),t.push(d),localStorage.setItem("berichten",JSON.stringify(t)),document.getElementById("input-nick").value="",document.getElementById("input-email").value="",document.getElementById("input-titel").value="",document.getElementById("input-bericht").value="",document.getElementById("berichten-lijst").innerHTML="",listBerichten(),showMessage("Bericht geplaatst","Bedankt voor het plaatsen van een bericht","success")):showMessage("Email niet geldig","Vul een geldig email-adres in!","error"):showMessage("Ontbrekende gegevens","Vul alle velden in!","error")}function listBerichten(){var e=document.getElementById("berichten-lijst"),t=getBerichten();if(t.length)for(let e=t.length-1;0<=e;e--)createBericht(t[e],e);else{var n=document.createElement("div"),d=document.createElement("h4");d.innerText="Er zijn nog geen berichten van klanten",n.appendChild(d),e.appendChild(n)}}export{populateResults,plaatsBericht,listBerichten};