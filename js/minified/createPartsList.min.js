import{getLiveKlant,getMandjes}from"./storageItems.js";import{Mandje,Artikel}from"./classes.js";import{showMessage,showToast}from"./notify.js";async function getParts(e,t){return(await fetch(`https://rebrickable.com/api/v3/lego/parts/?page=${e}&page_size=`+t,{method:"GET",headers:{Authorization:"key bc4537b496eaab6056e0ce49fb54bc55"}})).json()}function buildPage(e,t){getParts(e,t).then(e=>{var t=document.querySelectorAll(".part_wrap"),a=document.getElementById("pages_nav_div");t&&t.forEach(e=>{e.remove()}),a&&a.remove(),createPartsList(e),pageNavListeners(),addCartListeners()})}function createPartEl(e,t,a,d){var n=document.createElement("div"),s=document.createElement("div"),i=document.createElement("div"),r=document.createElement("div"),l=document.createElement("p"),c=document.createElement("div"),o=(c.classList.add("uk-width-1-2"),document.createElement("div")),u=(o.classList.add("uk-width-1-2"),document.createElement("p")),p=(u.classList.add("price"),document.createElement("img")),m=document.createElement("div"),g=(m.classList.add("uk-margin-bottom"),document.createElement("div")),h=(g.classList.add("uk-grid"),g.classList.add("uk-position-bottom"),g.style.left="20px",document.createElement("a")),L=document.createElement("span"),v=document.createElement("a"),L=(L.setAttribute("uk-icon","icon: cart; ratio: 2"),o.appendChild(L),p.id=e,p.src=a||"img/geen_afbeelding.jpg",n.classList.add("part_wrap"),s.classList.add("uk-card"),s.classList.add("uk-card-default"),s.classList.add("animate__animated"),s.classList.add("animate__fadeIn"),s.classList.add("animate__slow"),i.classList.add("uk-card-media-top"),r.classList.add("uk-card-body"),l.classList.add("uk-card-title"),i.appendChild(p),s.appendChild(i),l.innerText=t,v.classList.add("uk-button"),v.classList.add("uk-button-default"),v.classList.add("uk-button-small"),v.classList.add("part-detail"),v.href=d,v.setAttribute("target","_blank"),v.innerText="details",v.type="button",(5*Math.random()).toFixed(2));u.innerText="â‚¬"+L.toString(),c.appendChild(u),g.appendChild(c),h.href="",h.innerText="+",h.type="button",h.setAttribute("data-part",e),h.setAttribute("data-naam",t),h.setAttribute("data-prijs",L),h.classList.add("uk-button"),h.classList.add("uk-button-primary"),h.classList.add("add-button"),h.classList.add("uk-button-small"),o.appendChild(h),g.appendChild(o),r.appendChild(l),m.appendChild(v),r.appendChild(m),r.appendChild(g),s.appendChild(r),n.appendChild(s),parts_list.appendChild(n)}function addCartListeners(){const s=getLiveKlant();document.querySelectorAll(".add-button").forEach(e=>{e.addEventListener("click",e=>{if(e.preventDefault(),s){var t=document.querySelectorAll("span.badge-count");const n=getMandjes();var a=e.target.dataset.part,d=e.target.dataset["naam"],e=e.target.dataset["prijs"],a=new Artikel(a,d,e);n[s.naam]?n[s.naam].artikelen.push(a):((d=new Mandje(s)).artikelen.push(a),n[s.naam]=d),localStorage.setItem("mandjes",JSON.stringify(n)),t.forEach(e=>{e.innerText=n[s.naam].artikelen.length}),showToast("Artikel toegevoegd",a.naam+" is toegevoegd aan je mandje","success")}else showMessage("Niet ingelogd","Je moet ingelogd zijn om artikelen aan je mandje toe te kunnen voegen","warning")})})}function getPage(e){let t="1";e=e.split("&");let a=20;return(e[1]||"2"!==t)&&e[1]?(t=e[0].split("=")[1],a=e[1].split("=")[1]):t="1",sessionStorage.setItem("productPage",t),[t,a]}function pageNavListeners(){document.querySelectorAll(".pages-nav").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();e=getPage(e.target.href);window.scrollTo(0,0),buildPage(e[0],e[1])})})}function createPartsList(e){e.results.forEach(e=>{createPartEl(e.part_num,e.name,e.part_img_url,e.part_url)});var t=e.previous,e=e.next,a=document.createElement("div"),d=(a.id="pages_nav_div",a.classList.add("uk-container"),a.classList.add("uk-flex"),a.classList.add("uk-flex-between"),a.classList.add("uk-margin-top"),a.classList.add("uk-margin-bottom"),document.createElement("div")),n=document.createElement("a"),s=document.createElement("span"),t=(n.classList.add("uk-button"),n.classList.add("uk-button-default"),n.classList.add("pages-nav"),n.type="button",t?n.href=t:(n.href="#",n.style.color="#999999",n.style.cursor="not-allowed"),s.setAttribute("uk-icon","icon: chevron-left"),n.innerText="vorige",d.appendChild(s),d.appendChild(n),a.appendChild(d),document.createElement("div")),s=document.createElement("a"),n=document.createElement("span");s.classList.add("uk-button"),s.classList.add("uk-button-default"),s.classList.add("pages-nav"),s.type="button",e?s.href=e:(s.href="#",s.style.color="#999999",s.style.cursor="not-allowed"),n.setAttribute("uk-icon","icon: chevron-right"),s.innerText="volgende",t.appendChild(s),t.appendChild(n),a.appendChild(t),document.body.appendChild(a)}export{buildPage,getPage,pageNavListeners,createPartsList};