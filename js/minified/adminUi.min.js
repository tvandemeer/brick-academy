import{getKlanten,getMandjes,getLiveKlant,getCustomArtikelen}from"./storageItems.js";import{confirmDeleteKlant,confirmDeleteMandje,showMessage,showToast}from"./notify.js";import{updateNavbar}from"./navbar.js";import{Artikel}from"./classes.js";const Swal=window["Swal"];function deleteKlant(e){e=e.target.dataset.klant;e===getLiveKlant().naam?showMessage("Niet toegestaan!","Je kunt jezelf niet verwijderen","error"):confirmDeleteKlant(e,"Weet je het zeker?","De actie kan niet ongedaan gemaakt worden","warning")}function deleteMandje(e){e=e.target.dataset.klant;getMandjes()[e]?confirmDeleteMandje(e,"Weet je het zeker?","De actie kan niet ongedaan gemaakt worden","warning"):showMessage("Geen mandje","Deze klant heeft geen mandje","error")}function deleteArtikel(e){var n=e.target.dataset["klant"],e=parseInt(e.target.dataset.index),a=getMandjes(),d=a[n],l=d.artikelen.splice(e,1);if(l[0]){a[n]=d,localStorage.setItem("mandjes",JSON.stringify(a)),document.querySelector(`tr[data-row="${e}"`).remove();let t=0;var r=document.querySelectorAll("#results-table-body tr"),o=document.querySelectorAll("#results-table-body button");for(let e=0;e<d.artikelen.length;e++)r[e].setAttribute("data-row",e),o[e].setAttribute("data-index",e),t+=parseFloat(d.artikelen[e].prijs);document.getElementById("totaal")&&document.getElementById("totaal").remove();var n=document.getElementById("results-table-body"),a=document.createElement("tr"),e=(a.id="totaal",document.createElement("td")),m=document.createElement("td"),i=document.createElement("td"),c=document.createElement("td");e.innerText="",m.innerText="Totaalprijs",i.innerText="€"+t.toFixed(2).toString(),c.innerText="",a.appendChild(e),a.appendChild(m),a.appendChild(i),a.appendChild(c),n.appendChild(a),updateNavbar(),showToast("Verwijderd",l[0].naam,"success"),0===d.artikelen.length&&(console.log("Geen artikelen meer"),e=document.createElement("tr"),m=document.createElement("td"),i=document.createElement("td"),c=document.createElement("td"),m.innerText="---",i.innerText="Geen artikelen in mandje",c.innerText="---",e.appendChild(m),e.appendChild(i),e.appendChild(c),document.getElementById("results-table-body").appendChild(e))}else console.log("Er ging iets mis, maar weet nog niet wat")}function createCustomArtikel(e){var t=getCustomArtikelen(),n=document.getElementById("custom-id").value,a=document.getElementById("custom-naam").value,d=document.getElementById("custom-prijs").value,n=new Artikel(n,a,d);t.push(n),localStorage.setItem("customArtikelen",JSON.stringify(t)),document.getElementById("custom-id").value="",document.getElementById("custom-naam").value="",document.getElementById("custom-prijs").value="",populateCustom()}function deleteCustomArtikel(e){var e=parseInt(e.target.dataset.index),t=getCustomArtikelen();t.splice(e,1);localStorage.setItem("customArtikelen",JSON.stringify(t)),populateCustom()}function createRow(e,t,n){var a=document.getElementById("results-table-body"),d=document.createElement("tr"),l=(d.setAttribute("data-row",t),document.createElement("td")),r=document.createElement("td"),o=document.createElement("td"),m=document.createElement("td"),i=document.createElement("button");m.classList.add("uk-text-right"),i.classList.add("uk-button"),i.classList.add("uk-button-danger"),i.classList.add("uk-button-small"),i.type="button",i.setAttribute("data-index",t),i.setAttribute("data-klant",n),i.innerHTML="&times;",i.addEventListener("click",deleteArtikel),l.innerText=e.id,r.innerText=e.naam,o.innerText="€"+e.prijs,m.appendChild(i),d.appendChild(l),d.appendChild(r),d.appendChild(o),d.appendChild(m),a.appendChild(d)}function populateResults(e){var n=getMandjes(),a=document.querySelectorAll("#results-table-body tr"),d=(a.length&&a.forEach(e=>{e.remove()}),e.target.value);if("selecteer klant ..."!=d){if(n[d]&&0<n[d].artikelen.length){document.getElementById("delete-mandje-btn").style.backgroundColor="#F0506E";var l=n[d]["artikelen"];let t=0;for(let e=0;e<l.length;e++)createRow(l[e],e,d),t+=parseFloat(l[e].prijs);var a=document.getElementById("results-table-body"),e=document.createElement("tr"),r=(e.id="totaal",document.createElement("td")),o=document.createElement("td"),m=document.createElement("td"),i=document.createElement("td");r.innerText="",o.innerText="Totaalprijs",m.innerText="€"+t.toFixed(2).toString(),i.innerText="",e.appendChild(r),e.appendChild(o),e.appendChild(m),e.appendChild(i),a.appendChild(e)}else n[d]&&0===n[d].artikelen.length?(r=document.getElementById("results-table-body"),document.getElementById("delete-mandje-btn").style.backgroundColor="#F0506E",o=document.createElement("tr"),m=document.createElement("td"),i=document.createElement("td"),a=document.createElement("td"),m.innerText="---",i.innerText="Geen artikelen in mandje",a.innerText="---",o.appendChild(m),o.appendChild(i),o.appendChild(a),r.appendChild(o)):(document.getElementById("results-table-body"),e=document.createElement("tr"),n=document.createElement("td"),m=document.createElement("td"),i=document.createElement("td"),n.innerText="---",m.innerText="Deze klant heeft geen mandje",i.innerText="---",e.appendChild(n),e.appendChild(m),e.appendChild(i),noMandjeesults.appendChild(e),document.getElementById("delete-mandje-btn").style.backgroundColor="#888");document.getElementById("delete-klant-btn").setAttribute("data-klant",d),document.getElementById("delete-mandje-btn").setAttribute("data-klant",d)}else console.log("geen klant geselecteerd")}function populateSelect(){var e=document.getElementById("select-element"),t=(document.querySelectorAll("#select-element option").forEach(e=>{e.remove()}),document.querySelectorAll("#results-table-body tr")),n=(t.length&&t.forEach(e=>{e.remove()}),getKlanten()),t=document.createElement("option");e.appendChild(t),t.innerText="selecteer klant ...";for(const d in n){var a=document.createElement("option");a.innerText=n[d].naam,e.appendChild(a)}e.addEventListener("change",populateResults),document.getElementById("delete-klant-btn").addEventListener("click",deleteKlant),document.getElementById("delete-mandje-btn").addEventListener("click",deleteMandje)}function populateCustom(){var t=document.getElementById("custom-table-body"),e=document.querySelectorAll("#custom-table-body tr"),n=(e.length&&e.forEach(e=>{e.remove()}),getCustomArtikelen());if(n.length)for(let e=0;e<n.length;e++){var a=document.createElement("tr"),d=document.createElement("td"),l=document.createElement("td"),r=document.createElement("td"),o=document.createElement("td"),m=document.createElement("button");o.classList.add("uk-text-right"),m.classList.add("uk-button"),m.classList.add("uk-button-danger"),m.classList.add("uk-button-small"),m.type="button",m.innerHTML="&times;",m.setAttribute("data-index",e),m.addEventListener("click",deleteCustomArtikel),o.appendChild(m),d.innerText=n[e].id,l.innerText=n[e].naam,r.innerText="€"+n[e].prijs,a.appendChild(d),a.appendChild(l),a.appendChild(r),a.appendChild(o),t.appendChild(a)}}export{createCustomArtikel,populateSelect,populateCustom};